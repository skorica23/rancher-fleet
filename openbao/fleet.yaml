defaultNamespace: openbao

helm:
  # Name of the Helm release
  releaseName: openbao-ha
  takeOwnership: true
  atomic: true 
  # OpenBao official Helm chart
  chart: openbao
  repo: https://openbao.github.io/openbao-helm
  # Optional: pin a version, or leave empty to track latest
  # version: "0.19.3"

  force: false
  timeoutSeconds: 600

  values:
    # OpenBao server configuration
    server:
      ha:
        enabled: true
        # 3 OpenBao pods (HA cluster)
        replicaCount: 3

        injector:
          enabled: false       #this can be an internal service addres, which is the current case
         # externalVaultAddr: "https://openbao-ha-0.openbao-ha-internal:8201"
        # Enable Integrated Storage (Raft) backend
        raft:
          enabled: true
          # Recommended so each pod gets a stable node_id
          setNodeId: true
          # Minimal Raft + listener config (no TLS; good for lab/dev)
          # Adjust for production (enable TLS, auto-unseal, etc.)
          config: |-
            ui = false

            listener "tcp" {
              tls_disable     = 1
              address         = "[::]:8200"
              cluster_address = "[::]:8201"
            }

            storage "raft" {
              path = "/mnt/data"
            }

            service_registration "kubernetes" {}
      podTemplate:
        nodeSelector:
          openbao-node: "true"
        
        affinity:
          nodeAffinity:
            requiredDuringSchedulingIgnoredDuringExecution:
             nodeSelectorTerms:
              - matchExpressions:
                - key: openbao-node
                  operator: Exists
      # Persistent storage for Raft data
      dataStorage:
        enabled: true
        size: 8Gi
        # Adjust to your cluster storage class
        storageClass: "local-path"

    # Optional: enable UI and expose via a ClusterIP service
    ui:
      enabled: true
      serviceType: NodePort
      serviceNodePort: 32000
